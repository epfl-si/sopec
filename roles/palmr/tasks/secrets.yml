- name: Create application secret
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: "{{ app }}-secrets"
        namespace: "{{ openshift_namespace }}"
      type: Opaque
      stringData:
        DB_TYPE: postgresdb
        DB_POSTGRESDB_HOST: postgres-cluster-rw
        DB_POSTGRESDB_PORT: "5432"
        DB_POSTGRESDB_DATABASE: "{{ app }}-db"
        DB_POSTGRESDB_USER: "{{ app }}-user"
        DB_POSTGRESDB_PASSWORD: "{{ secrets[openshift_env].database.password }}"
        DATABASE_URL: "postgresql://{{ app }}-user:{{ secrets[openshift_env].database.password }}@postgres-cluster-rw:5432/{{ app }}-db"
        API_BASE_URL: "https://{{ subdomain }}{% if openshift_env == 'test' %}-test{% endif %}.{{ domain }}"
        NEXT_PUBLIC_DEFAULT_LANGUAGE: "en-US"
        DISABLE_FILESYSTEM_ENCRYPTION: true
        ENABLE_S3: true
        S3_ENDPOINT: "{{ secrets[openshift_env].s3.endpoint }}"
        S3_PORT: "443"
        S3_USE_SSL: false
        S3_ACCESS_KEY: "{{ secrets[openshift_env].s3.accesskey }}"
        S3_SECRET_KEY: "{{ secrets[openshift_env].s3.secretkey }}"
        S3_BUCKET_NAME: "{{ secrets[openshift_env].s3.name }}"
        S3_FORCE_PATH_STYLE: true
        S3_REJECT_UNAUTHORIZED: false
        PRESIGNED_URL_EXPIRATION: "3600"
